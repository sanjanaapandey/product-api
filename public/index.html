<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Product Inventory</title>
  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body {
      margin: 0; padding: 2rem; min-height: 100vh;
      background: radial-gradient(ellipse at top, #1e1e2f 0%, #121218 100%);
      color: #e0e0e0; display: flex; flex-direction: column; align-items: center; gap: 2rem;
    }
    h1 { font-size: 2.5rem; font-weight: 600; color: #f0f0f0; }
    #form-container { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; align-items: center; }
    input {
      background: rgba(255, 255, 255, 0.05); color: #f0f0f0; border: 1px solid #444;
      padding: 10px 14px; border-radius: 8px; outline: none; transition: border 0.3s ease;
    }
    input:focus { border-color: #5c8df6; }
    button {
      background: #5c8df6; color: white; border: none; border-radius: 8px;
      padding: 10px 16px; cursor: pointer; font-weight: 500;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    button:hover { background: #3b6be0; transform: translateY(-1px); }
    .glass {
      width: 100%; max-width: 900px; padding: 20px; border-radius: 16px;
      background: rgba(255, 255, 255, 0.06); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.12);
    }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 1rem; text-align: left; }
    th { background-color: rgba(255, 255, 255, 0.05); cursor: pointer; }
    tr { border-bottom: 1px solid rgba(255, 255, 255, 0.08); }
    td button { padding: 6px 12px; border-radius: 6px; color: white; font-weight: 500; margin-right: 6px; }
    td .delete-btn { background: #ff4e4e; }
    td .delete-btn:hover { background: #d63c3c; }
    td .edit-btn { background: #f6b93b; }
    td .edit-btn:hover { background: #e58e26; }
    .alert { padding: 12px; margin: -1rem 0 1rem; border-radius: 6px; width: 100%; max-width: 900px; text-align: center; }
    .alert.success { background-color: #224c26; color: #d1ffd9; }
    .alert.error { background-color: #5c1e1e; color: #ffd2d2; }
    #pagination { margin-top: 1rem; display: flex; justify-content: center; gap: 1rem; }
    #pagination button { padding: 8px 14px; }
  </style>
</head>
<body>
  <h1>Product Inventory</h1>

  <div id="form-container">
    <input id="name" placeholder="Product Name" />
    <input id="price" placeholder="Price" type="number" />
    <input id="description" placeholder="Description" />
    <button id="submitBtn" onclick="submitProduct()">Add</button>
    <button id="cancelBtn" onclick="resetForm()" style="display:none; background:#777;">Cancel</button>
    <input id="search" placeholder="Search..." oninput="searchProducts()" />
    <button onclick="clearSearch()">Clear</button>
  </div>

  <div id="alert" class="alert" style="display: none;"></div>

  <div class="glass">
    <table>
      <thead>
        <tr>
          <th onclick="sortBy('id')">ID ⬍</th>
          <th onclick="sortBy('name')">Name ⬍</th>
          <th onclick="sortBy('price')">Price ⬍</th>
          <th>Description</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="productBody"></tbody>
    </table>
    <div id="pagination">
      <button onclick="prevPage()">Previous</button>
      <span id="pageInfo"></span>
      <button onclick="nextPage()">Next</button>
    </div>
  </div>

  <script>
    const api = 'http://localhost:3000/products';
    let products = [];
    let sortKey = 'id';
    let sortDirection = 'asc';
    let editingId = null;
    let currentPage = 1;
    const limit = 5;

    async function fetchProducts(page = 1) {
      const res = await fetch(`${api}?page=${page}&limit=${limit}`);
      const data = await res.json();
      products = data.data || data; // depending on your API format
      renderTable(products);
      currentPage = page;
      document.getElementById('pageInfo').textContent = `Page ${currentPage}`;
    }

    async function submitProduct() {
      const name = document.getElementById('name').value.trim();
      const price = parseFloat(document.getElementById('price').value);
      const description = document.getElementById('description').value.trim();
      if (!name || isNaN(price)) {
        showAlert('Please enter valid name and price.', 'error');
        return;
      }
      if (editingId) {
        const res = await fetch(`${api}/${editingId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, price, description }),
        });
        if (res.ok) { showAlert('Product updated successfully!', 'success'); resetForm(); fetchProducts(currentPage); }
        else { const err = await res.json(); showAlert(err.message || 'Failed to update product.', 'error'); }
      } else {
        const res = await fetch(api, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, price, description }),
        });
        if (res.ok) { showAlert('Product added successfully!', 'success'); resetForm(); fetchProducts(currentPage); }
        else { const err = await res.json(); showAlert(err.message || 'Failed to add product.', 'error'); }
      }
    }

    function editProduct(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;
      document.getElementById('name').value = product.name;
      document.getElementById('price').value = product.price;
      document.getElementById('description').value = product.description;
      editingId = id;
      document.getElementById('submitBtn').textContent = 'Update';
      document.getElementById('cancelBtn').style.display = 'inline-block';
    }

    async function deleteProduct(id) {
      if (!confirm('Are you sure you want to delete this product?')) return;
      await fetch(`${api}/${id}`, { method: 'DELETE' });
      showAlert('Product deleted.', 'success');
      fetchProducts(currentPage);
    }

    async function searchProducts() {
      const query = document.getElementById('search').value.trim();
      if (!query) { fetchProducts(currentPage); return; }
      const res = await fetch(`${api}/search?q=${query}`);
      const data = await res.json();
      renderTable(data);
    }

    function clearSearch() { document.getElementById('search').value = ''; fetchProducts(currentPage); }

    function renderTable(data) {
      const body = document.getElementById('productBody');
      body.innerHTML = '';
      const sorted = [...data].sort((a, b) => {
        const valA = typeof a[sortKey] === 'string' ? a[sortKey].toLowerCase() : a[sortKey];
        const valB = typeof b[sortKey] === 'string' ? b[sortKey].toLowerCase() : b[sortKey];
        if (valA < valB) return sortDirection === 'asc' ? -1 : 1;
        if (valA > valB) return sortDirection === 'asc' ? 1 : -1;
        return 0;
      });
      for (const p of sorted) {
        body.innerHTML += `
          <tr>
            <td>${p.id}</td>
            <td>${p.name}</td>
            <td>$${p.price}</td>
            <td>${p.description}</td>
            <td>
              <button class="edit-btn" onclick="editProduct(${p.id})">Edit</button>
              <button class="delete-btn" onclick="deleteProduct(${p.id})">Delete</button>
            </td>
          </tr>`;
      }
    }

    function sortBy(key) {
      if (sortKey === key) { sortDirection = sortDirection === 'asc' ? 'desc' : 'asc'; }
      else { sortKey = key; sortDirection = 'asc'; }
      renderTable(products);
    }

    function showAlert(msg, type) {
      const alert = document.getElementById('alert');
      alert.textContent = msg; alert.className = `alert ${type}`; alert.style.display = 'block';
      setTimeout(() => alert.style.display = 'none', 3000);
    }

    function resetForm() {
      document.getElementById('name').value = '';
      document.getElementById('price').value = '';
      document.getElementById('description').value = '';
      document.getElementById('submitBtn').textContent = 'Add';
      document.getElementById('cancelBtn').style.display = 'none';
      editingId = null;
    }

    function nextPage() { fetchProducts(currentPage + 1); }
    function prevPage() { if (currentPage > 1) fetchProducts(currentPage - 1); }

    fetchProducts();
  </script>
</body>
</html>
